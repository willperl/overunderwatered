---
title: 1. Single file
layout: page
---

<input id="photo" type="file" />
<div id="results"></div>

<script>
  async function joinQueue() {
    const resp = await fetch("https://smittens-overorunderwatered.hf.space/gradio_api/queue/join", {
      method: "POST",
    });
    const data = await resp.json();
    if (!data.session_hash) throw new Error("No session hash returned from queue/join");
    return data.session_hash;
  }

  async function submitPrediction(session_hash, base64Image) {
    const resp = await fetch("https://smittens-overorunderwatered.hf.space/gradio_api/queue/predict/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        fn_index: 0,             // replace with your function index
        session_hash: session_hash,
        data: [base64Image]
      }),
    });
    const data = await resp.json();
    if (data.error) throw new Error(data.error);
    return data;
  }

  async function pollResult(session_hash, interval = 1000, maxTries = 30) {
    for (let i = 0; i < maxTries; i++) {
      const resp = await fetch(`https://smittens-overorunderwatered.hf.space/gradio_api/queue/data?session_hash=${session_hash}`);
      const data = await resp.json();
      if (data && data.data) {
        return data.data;
      }
      await new Promise(r => setTimeout(r, interval));
    }
    throw new Error("Timed out waiting for prediction result");
  }

  async function predictBase64(base64Image) {
    try {
      document.getElementById("results").innerHTML = "Joining queue...";
      const session_hash = await joinQueue();

      document.getElementById("results").innerHTML = "Submitting prediction...";
      await submitPrediction(session_hash, base64Image);

      document.getElementById("results").innerHTML = "Waiting for result...";
      const resultData = await pollResult(session_hash);

      const label = resultData[0].confidences[0].label;
      const conf = resultData[0].confidences[0].confidence;

      document.getElementById("results").innerHTML = `
        <img src="${base64Image}" width="300" />
        <p><strong>Prediction:</strong> ${label}</p>
        <p><strong>Confidence:</strong> ${(conf * 100).toFixed(2)}%</p>
      `;
    } catch (err) {
      document.getElementById("results").innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
      console.error(err);
    }
  }

  document.getElementById("photo").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => predictBase64(reader.result);
    reader.readAsDataURL(file);
  });
</script>
