---
title: 3. Tester
layout: page
---

	<h1>Upload an Image of Your Plant</h1>
	<form id="uploadForm">
		<input type="file" id="fileInput" accept="image/*" required>
		<button type="submit">Submit</button>
	</form>

	<div id="result" hidden></div>

	<script>
	async function callGradioWithFile(file) {
	const blobURL = URL.createObjectURL(file);

	const payload = {
		data: [
			{
				path: blobURL,
				meta: { _type: "gradio.FileData" }
			}
		]
	};

	const predictURL = "https://smittens-overorunderwatered.hf.space/gradio_api/call/predict";
	const response = await fetch(predictURL, {
		method: "POST",
		headers: { "Content-Type": "application/json" },
		body: JSON.stringify(payload)
	});

	const result = await response.json();
	const eventId = result.event_id;

	if (!eventId) throw new Error("No event ID returned");

	const streamRes = await fetch(`${predictURL}/${eventId}`);
	const rawText = await streamRes.text();

	console.log("ðŸ“¥ Raw response:\n" + rawText);

	const match = rawText.match(/^data:\s*(.*)$/m);
	if (!match || !match[1]) throw new Error("No valid data in response");

	const parsed = JSON.parse(match[1]);
	console.log("ðŸŽ‰ Parsed result:", parsed);
	return parsed;
}


	document.getElementById("uploadForm").addEventListener("submit", async (e) => {
		e.preventDefault();

		const file = document.getElementById("fileInput").files[0];
		const resultDiv = document.getElementById("result");

		if (!file) return;

		resultDiv.hidden = false;
		resultDiv.innerHTML = "<em>Processing...</em>";

		try {
			const output = await callGradioWithFile(file);
			const prediction = output[0];

			let html = `<h2>Prediction: ${prediction.label}</h2>`;
			html += `<div><strong>Confidence scores:</strong></div>`;

			for (const c of prediction.confidences) {
				const percent = (c.confidence * 100).toFixed(2);
				html += `
					<div>${c.label} (${percent}%)</div>
					<div class="confidence-bar">
						<div class="confidence-fill" style="width: ${percent}%;"></div>
					</div>
				`;
			}

			resultDiv.innerHTML = html;
		} catch (err) {
			resultDiv.innerHTML = `<strong>Error:</strong> ${err.message}`;
			console.error("Final error:", err);
		}
	});
	</script>
