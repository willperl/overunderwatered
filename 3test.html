---
title: 3. Tester
layout: page
---

<input type="file" id="fileInput" required>
<button onclick="handleUpload()">Classify</button>
<pre id="output"></pre>

<script>
async function fileToImageDataObject(file) {
  const base64 = await new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });

  // Note: shape can be omitted or guessed, but including is better
  // If you want to read image dimensions, you can create an Image element and read it, but optional

  return {
    name: file.name,
    data: base64,
    _type: "image-file"
  };
}

async function callGradioWithImageObject(imageDataObject) {
  const payload = {
    data: [imageDataObject]
  };

  const predictURL = "https://smittens-overorunderwatered.hf.space/gradio_api/call/predict";
  const response = await fetch(predictURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  const result = await response.json();
  const eventId = result.event_id;
  if (!eventId) throw new Error("No event ID returned");

  const streamRes = await fetch(`${predictURL}/${eventId}`);
  const rawText = await streamRes.text();

  console.log("üì• Raw response:\n" + rawText);

  const match = rawText.match(/^data:\s*(.*)$/m);
  if (!match || !match[1]) throw new Error("No valid data in response");

  const parsed = JSON.parse(match[1]);
  console.log("üéâ Parsed result:", parsed);
  return parsed;
}

async function handleUpload() {
  const file = document.getElementById("fileInput").files[0];
  const output = document.getElementById("output");

  if (!file) return;

  output.textContent = "üß† Classifying...";

  try {
    const imageDataObject = await fileToImageDataObject(file);
    const result = await callGradioWithImageObject(imageDataObject);
    output.textContent = "‚úÖ Result:\n" + JSON.stringify(result, null, 2);
  } catch (err) {
    console.error(err);
    output.textContent = "‚ùå Error: " + err.message;
  }
}

</script>
