---
title: 3. Tester
layout: page
---

<input type="file" id="fileInput" required>
<button onclick="handleUpload()">Classify</button>
<pre id="output"></pre>

<script>
function fileToBase64(file) {
	return new Promise((resolve, reject) => {
		const reader = new FileReader();
		reader.onload = () => resolve(reader.result);
		reader.onerror = reject;
		reader.readAsDataURL(file); // converts to base64 data URI
	});
}

async function callGradioWithBase64Image(base64Data) {
	const payload = {
		data: [base64Data] // no 'path', no 'meta', just the base64 data URI
	};

	const predictURL = "https://smittens-overorunderwatered.hf.space/gradio_api/call/predict";
	const response = await fetch(predictURL, {
		method: "POST",
		headers: { "Content-Type": "application/json" },
		body: JSON.stringify(payload)
	});

	const result = await response.json();
	const eventId = result.event_id;
	if (!eventId) throw new Error("No event ID returned");

	const streamRes = await fetch(`${predictURL}/${eventId}`);
	const rawText = await streamRes.text();

	console.log("üì• Raw response:\n" + rawText);

	const match = rawText.match(/^data:\s*(.*)$/m);
	if (!match || !match[1]) throw new Error("No valid data in response");

	const parsed = JSON.parse(match[1]);
	console.log("üéâ Parsed result:", parsed);
	return parsed;
}

async function handleUpload() {
	const file = document.getElementById("fileInput").files[0];
	const output = document.getElementById("output");

	if (!file) return;

	output.textContent = "üß† Classifying...";

	try {
		const base64 = await fileToBase64(file);
		const result = await callGradioWithBase64Image(base64);
		output.textContent = "‚úÖ Result:\n" + JSON.stringify(result, null, 2);
	} catch (err) {
		console.error(err);
		output.textContent = "‚ùå Error: " + err.message;
	}
}
</script>
