---
title: 3. Tester
layout: page
---

<h2>Upload an image</h2>
	<input type="file" id="fileInput" />
	<pre id="output"></pre>

	<script>
		const predictURL = "https://smittens-overorunderwatered.hf.space/gradio_api/call/predict";

		async function fileToDataURL(file) {
			return await new Promise((resolve, reject) => {
				const reader = new FileReader();
				reader.onload = () => resolve(reader.result);
				reader.onerror = reject;
				reader.readAsDataURL(file);
			});
		}

		async function uploadAndClassify(file) {
			const base64 = await fileToDataURL(file);

			const payload = {
				data: [
					{
						name: file.name,
						data: base64,
						_type: "image"
					}
				]
			};

			const res = await fetch(predictURL, {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify(payload)
			});

			const { event_id } = await res.json();
			if (!event_id) throw new Error("No event_id returned");

			const stream = await fetch(`${predictURL}/${event_id}`);
			const raw = await stream.text();

			console.log("ğŸ”» Raw stream:\n", raw);

			const match = raw.match(/^data:\s*(.*)$/m);
			if (!match) throw new Error("No JSON data in stream");

			const parsed = JSON.parse(match[1]);
			return parsed;
		}

		document.getElementById("fileInput").addEventListener("change", async (e) => {
			const file = e.target.files[0];
			const output = document.getElementById("output");

			if (!file) return;

			output.textContent = "ğŸ§  Classifying...";

			try {
				const result = await uploadAndClassify(file);
				output.textContent = "âœ… Result:\n" + JSON.stringify(result, null, 2);
			} catch (err) {
				console.error(err);
				output.textContent = "âŒ Error: " + err.message;
			}
		});
	</script>