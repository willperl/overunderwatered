---
title: 3. Tester
layout: page
---

	<input type="file" id="fileInput" required>
<button onclick="handleUpload()">Upload & Classify</button>
<pre id="output"></pre>

<script>
async function uploadFileToFileIO(file) {
	const formData = new FormData();
	formData.append("file", file);

	const res = await fetch("https://file.io/?expires=1d", {
		method: "POST",
		body: formData
	});

	const json = await res.json();
	if (!json.success) throw new Error("Upload failed");
	console.log("üåç File URL:", json.link);
	return json.link;
}

async function callGradioWithURL(fileURL) {
	const payload = {
		data: [
			{
				path: fileURL,
				meta: { _type: "gradio.FileData" }
			}
		]
	};

	const predictURL = "https://smittens-overorunderwatered.hf.space/gradio_api/call/predict";
	const response = await fetch(predictURL, {
		method: "POST",
		headers: { "Content-Type": "application/json" },
		body: JSON.stringify(payload)
	});

	const result = await response.json();
	const eventId = result.event_id;
	if (!eventId) throw new Error("No event ID returned");

	const streamRes = await fetch(`${predictURL}/${eventId}`);
	const rawText = await streamRes.text();

	console.log("üì• Raw response:\n" + rawText);

	const match = rawText.match(/^data:\s*(.*)$/m);
	if (!match || !match[1]) throw new Error("No valid data in response");

	const parsed = JSON.parse(match[1]);
	console.log("üéâ Parsed result:", parsed);
	return parsed;
}

async function handleUpload() {
	const file = document.getElementById("fileInput").files[0];
	if (!file) return;

	document.getElementById("output").textContent = "Uploading...";
	try {
		const fileURL = await uploadFileToFileIO(file);
		document.getElementById("output").textContent = "Classifying...";

		const result = await callGradioWithURL(fileURL);
		document.getElementById("output").textContent = JSON.stringify(result, null, 2);
	} catch (err) {
		console.error(err);
		document.getElementById("output").textContent = "‚ùå Error: " + err.message;
	}
}
</script>
